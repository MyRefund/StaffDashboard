<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>My Refund — Processing Workspace</title>

<style>
body{font-family:Arial,Helvetica,sans-serif;margin:0;padding:20px;background:#f7f7f7}
header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
h1{margin:0;font-size:20px}
.section{background:#fff;padding:15px;border-radius:8px;margin-bottom:20px}
table{width:100%;border-collapse:collapse}
td,th{padding:6px;border-bottom:1px solid #ddd;text-align:left}
input{padding:6px;width:100px}
button{padding:6px 10px;margin:4px 0}
.total{font-size:18px;font-weight:bold}
</style>
</head>

<body>

<header>
<div>
<h1>Processing — <span id="staffNameLabel"></span></h1>
<div id="todayDate"></div>
</div>
<div id="clock"></div>
</header>

<div class="section">
<h3>Add Fee Entry</h3>
<select id="typeSelect" onchange="currentType=this.value">
<option value="">Select Type</option>
<option value="ITA">ITA</option>
<option value="IR3">IR3</option>
<option value="REB">REB</option>
</select>
<input id="amountInput" placeholder="$0.00">
<label><input type="checkbox" id="receiptAssist"> Receipt Assist</label>
<button onclick="addEntry()">Add</button>
</div>

<div class="section">
<h3>Entries (<span id="entryCount">0</span>)</h3>
<table>
<thead>
<tr><th>Time</th><th>Type</th><th>Fee</th><th></th></tr>
</thead>
<tbody id="logTable"></tbody>
</table>
<div class="total">Total Fees: $<span id="totalFees">0.00</span></div>
</div>

<div class="section">
<h3>Output Counters</h3>
Filing <input id="filing" type="number" value="0"><br>
Linking <input id="linking" type="number" value="0"><br>
Linked Review <input id="linkedreview" type="number" value="0"><br>
Inbox <input id="inbox" type="number" value="0"><br>
Existing Review <input id="existingreview" type="number" value="0"><br>
Processing Review <input id="processingreview" type="number" value="0"><br>
Misc <input id="misc" type="number" value="0"><br><br>
<button onclick="submitDay()">Submit Day</button>
</div>

<script>
document.addEventListener("DOMContentLoaded", function(){

const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwCZTuvnbwTAfkDXMjbLzCR-YXkzcbQ-hujbrZW7Hib5iLhbVwfkJ1xmSfpu-YfRGTn/exec";

const TZ="Pacific/Auckland";
const name=localStorage.getItem("currentStaff")||"Processing";
const todayISO=new Date().toLocaleDateString("en-CA",{timeZone:TZ});
const storageKey=`processing_${name}_${todayISO}`;

let entries=[];
let submitted=false;
window.currentType=null;

const staffNameLabel=document.getElementById("staffNameLabel");
const todayDate=document.getElementById("todayDate");
const clock=document.getElementById("clock");
const logTable=document.getElementById("logTable");
const entryCount=document.getElementById("entryCount");
const totalFees=document.getElementById("totalFees");

const filing=document.getElementById("filing");
const linking=document.getElementById("linking");
const linkedreview=document.getElementById("linkedreview");
const inbox=document.getElementById("inbox");
const existingreview=document.getElementById("existingreview");
const processingreview=document.getElementById("processingreview");
const misc=document.getElementById("misc");

staffNameLabel.textContent=name;
todayDate.textContent=new Date().toLocaleDateString("en-NZ",
{weekday:"long",day:"numeric",month:"long",year:"numeric",timeZone:TZ});

function cleanAmount(v){return parseFloat(v.replace(/[$, ]/g,''));}

function calculateFee(type,R){
if(type==="ITA"){
let f=(R*0.11+34.5)*1.15;
if(R<39.68)return R;
return f>345?345:f;
}
if(type==="IR3"){
let f=(R*0.11+49.5)*1.15;
if(R<56.93)return R;
return f>402.5?402.5:f;
}
if(type==="REB"){
let tier=R<500?45.99:R<2000?68.99:91.99;
if(document.getElementById("receiptAssist").checked)tier+=6.89;
return R<tier?R:tier;
}
return 0;
}

window.addEntry=function(){
if(submitted||!currentType)return;
let R=cleanAmount(document.getElementById("amountInput").value||"");
if(!R)return;
let fee=calculateFee(currentType,R);
entries.push({
type:currentType,
fee,
time:new Date().toLocaleTimeString("en-NZ",{hour:"numeric",minute:"2-digit"})
});
document.getElementById("amountInput").value="";
renderLog();
updateTotal();
};

function renderLog(){
logTable.innerHTML="";
entries.forEach((e,i)=>{
logTable.innerHTML+=`<tr>
<td>${e.time}</td>
<td>${e.type}</td>
<td>$${e.fee.toFixed(2)}</td>
<td></td>
</tr>`;
});
entryCount.textContent=entries.length;
}

function updateTotal(){
totalFees.textContent=
entries.reduce((s,e)=>s+e.fee,0).toFixed(2);
}

window.submitDay=async function(){
alert("Processing day successfully submitted.");
};

function tick(){
clock.textContent=new Date().toLocaleTimeString("en-NZ",
{hour:"numeric",minute:"2-digit",second:"2-digit"});
}
tick();
setInterval(tick,1000);

});
</script>

</body>
</html>
