<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="Content-Language" content="en">
<meta name="google" content="notranslate">
<title>My Refund — Processing Workspace</title>

<style>
:root{
--g0:#094B35;
--g2:#ECFDF5;
--text:#111827;
--muted:#6b7280;
--border:#e5e7eb;
--radius:16px;
--shadow:0 12px 32px rgba(0,0,0,.14);
}
*{box-sizing:border-box}
body{margin:0;font-family:"Okta Neue",system-ui;color:var(--text);}
.page{min-height:100vh;background:url("My Refund-Hero Images-02 (1).jpg") center/cover no-repeat;}
.header{background:var(--g0);color:#fff;padding:14px 24px;}
.header-inner{max-width:1300px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;}
.brand{display:flex;align-items:center;gap:14px;}
.brand img{height:26px}
.brand-text strong{font-size:15px;font-weight:900;}
.brand-text span{font-size:12px;opacity:.9;font-weight:700;}
.clock{font-weight:900;font-size:14px;}
.tabs{background:#fff;padding:12px 24px;display:flex;gap:10px;border-bottom:1px solid var(--border);}
.tab{border-radius:999px;padding:8px 16px;font-weight:900;font-size:13px;border:1px solid var(--g0);background:#fff;color:var(--g0);cursor:pointer;}
.tab.active{background:var(--g0);color:#fff;}
.wrap{max-width:1300px;margin:0 auto;padding:36px 24px 60px;}
.layout{display:grid;grid-template-columns:1fr 260px;gap:24px;}
.panel{background:rgba(255,255,255,.96);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px;margin-bottom:20px;}
.panel h3{margin:0 0 14px;font-size:18px;font-weight:900;color:var(--g0);}
.fee-panel{border-top:6px solid var(--g0);}
.banner{background:#fff3cd;border-left:6px solid #f0ad4e;padding:12px 16px;margin-bottom:20px;font-weight:800;border-radius:12px;}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:14px;}
.item{background:#fff;border:1px solid var(--border);border-radius:14px;padding:14px;}
.item label{display:block;font-weight:900;margin-bottom:8px;}
.controls{display:flex;align-items:center;gap:6px;}
.controls button{width:32px;height:32px;border-radius:8px;border:1px solid var(--border);background:#fff;font-weight:900;cursor:pointer;}
.controls input{width:56px;text-align:center;border:1px solid var(--border);border-radius:8px;padding:6px;font-weight:900;}
.button-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:12px;margin-bottom:16px;}
.type-btn{border-radius:12px;padding:10px;font-weight:900;border:2px solid var(--g0);background:#fff;color:var(--g0);cursor:pointer;}
.type-btn.active{background:var(--g0);color:#fff;}
input{padding:10px;border-radius:10px;border:1px solid var(--border);font-weight:700;}
.add-btn{padding:10px 16px;border:none;border-radius:12px;background:var(--g0);color:#fff;font-weight:900;cursor:pointer;}
table{width:100%;border-collapse:collapse;}
th,td{border-bottom:1px solid var(--border);padding:8px;font-size:13px;}
th{color:var(--muted);font-weight:900;text-align:left;}
.total-box{background:var(--g2);border-radius:12px;padding:14px;font-weight:900;font-size:18px;text-align:right;}
.submit button{width:100%;border-radius:14px;padding:14px;font-weight:900;font-size:15px;border:none;background:var(--g0);color:#fff;cursor:pointer;}
.collapsible-header{display:flex;justify-content:space-between;align-items:center;cursor:pointer;font-weight:900;}
.hidden{display:none;}
@media(max-width:1100px){.layout{grid-template-columns:1fr}}
</style>
</head>

<body>
<div class="page">

<div class="header">
<div class="header-inner">
<div class="brand">
<img src="logo.png">
<div class="brand-text">
<strong id="staffNameLabel">Processing</strong>
<span>Daily Work Logger</span>
</div>
</div>
<div class="clock" id="clock"></div>
</div>
</div>

<div class="tabs">
<button class="tab active" onclick="switchTab('work', this)">Work Log</button>
<button class="tab" onclick="switchTab('resources', this)">Resources</button>
</div>

<div class="wrap">
<div id="workTab">

<div id="warningBanner" class="banner hidden"></div>

<div style="margin-bottom:28px;">
<div style="font-size:24px;font-weight:900;color:var(--g0);">
Hello, <span id="helloName"></span>
</div>
<div style="margin-top:6px;font-size:13px;font-weight:800;color:var(--muted);">
<span id="todayDate"></span> • Division: Processing
</div>
</div>

<div class="layout">
<div>

<div class="panel fee-panel">
<h3>Return Fee Logging</h3>

<div class="button-grid">
<button class="type-btn" onclick="selectType(event,'ITA')">ITA</button>
<button class="type-btn" onclick="selectType(event,'IR3')">IR3</button>
<button class="type-btn" onclick="selectType(event,'REB')">REB</button>
<button class="type-btn" onclick="autoAdd('AA')">AA</button>
<button class="type-btn" onclick="autoAdd('R3P')">R3P</button>
<button class="type-btn" onclick="autoAdd('OP')">OP</button>
</div>

<div id="inputSection" class="hidden">
<input type="text" id="amountInput" placeholder="Refund Amount">
<label id="receiptLabel" class="hidden">
<input type="checkbox" id="receiptAssist"> Add receipt assistance
</label>
<button class="add-btn" onclick="addEntry()">Add</button>
</div>
</div>

<div class="panel fee-panel">
<div class="collapsible-header" onclick="toggleLog()">
<span>Today’s Fee Entries (<span id="entryCount">0</span>)</span>
<span id="toggleIcon">▼</span>
</div>
<div id="logContainer" class="hidden">
<table>
<thead><tr><th>Time</th><th>Type</th><th>Fee</th><th></th></tr></thead>
<tbody id="logTable"></tbody>
</table>
</div>
</div>

<div class="panel fee-panel">
<div class="total-box">
Total Fees Today: $<span id="totalFees">0.00</span>
</div>
</div>

<div class="submit">
<button onclick="submitDay()">Submit & Finish Day</button>
</div>

</div>
</div>
</div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function(){

const WEB_APP_URL="https://script.google.com/macros/s/AKfycbwCZTuvnbwTAfkDXMjbLzCR-YXkzcbQ-hujbrZW7Hib5iLhbVwfkJ1xmSfpu-YfRGTn/exec";
const TZ="Pacific/Auckland";
const name=localStorage.getItem("currentStaff")||"Processing";
const todayISO=new Date().toLocaleDateString("en-CA",{timeZone:TZ});
const storageKey=`processing_${name}_${todayISO}`;

let entries=[];
let submitted=false;
let currentType=null;

/* HEADER */
staffNameLabel.textContent=name;
helloName.textContent=name;
todayDate.textContent=new Date().toLocaleDateString("en-NZ",{weekday:"long",day:"numeric",month:"long",year:"numeric",timeZone:TZ});

/* ENTER KEY SUPPORT */
amountInput.addEventListener("keydown", function(e){
if(e.key==="Enter"){
e.preventDefault();
addEntry();
}
});

/* GLOBAL FUNCTIONS */

window.selectType=function(e,type){
if(submitted)return;
currentType=type;
document.querySelectorAll(".type-btn").forEach(b=>b.classList.remove("active"));
e.target.classList.add("active");
inputSection.classList.remove("hidden");
receiptLabel.classList.toggle("hidden",type!=="REB");
amountInput.focus();
};

window.autoAdd=function(type){
if(submitted)return;
let fee=39.10;
entries.push({type,fee,time:new Date().toLocaleTimeString("en-NZ",{hour:"numeric",minute:"2-digit"})});
renderLog();updateTotal();
};

window.addEntry=function(){
if(submitted||!currentType)return;
let R=parseFloat((amountInput.value||"").replace(/[$, ]/g,''))||0;
if(!R)return;
let fee=R;
if(currentType==="ITA"){let f=(R*0.11+34.5)*1.15;if(R>=39.68)fee=Math.min(f,345);}
if(currentType==="IR3"){let f=(R*0.11+49.5)*1.15;if(R>=56.93)fee=Math.min(f,402.5);}
if(currentType==="REB"){let tier=R<500?45.99:R<2000?68.99:91.99;if(receiptAssist.checked)tier+=6.89;fee=Math.min(R,tier);}
entries.push({type:currentType,fee,time:new Date().toLocaleTimeString("en-NZ",{hour:"numeric",minute:"2-digit"})});
amountInput.value="";
renderLog();updateTotal();
};

window.deleteEntry=function(i){
if(submitted)return;
entries.splice(i,1);
renderLog();updateTotal();
};

window.toggleLog=function(){
logContainer.classList.toggle("hidden");
toggleIcon.textContent=logContainer.classList.contains("hidden")?"▼":"▲";
};

window.submitDay=async function(){
if(submitted)return;
if(!confirm("Submit day? This cannot be edited."))return;
await fetch(WEB_APP_URL,{method:"POST",mode:"no-cors"});
submitted=true;
alert("Processing day successfully submitted.");
};

function renderLog(){
logTable.innerHTML="";
entries.forEach((e,i)=>{
logTable.innerHTML+=`
<tr>
<td>${e.time}</td>
<td>${e.type}</td>
<td>$${e.fee.toFixed(2)}</td>
<td>${!submitted?`<button onclick="deleteEntry(${i})">✕</button>`:''}</td>
</tr>`;
});
entryCount.textContent=entries.length;
}

function updateTotal(){
totalFees.textContent=entries.reduce((s,e)=>s+e.fee,0).toFixed(2);
}

function tick(){
clock.textContent=new Date().toLocaleTimeString("en-NZ",{hour:"numeric",minute:"2-digit",second:"2-digit"});
}
tick();setInterval(tick,1000);

});
</script>

</body>
</html>
