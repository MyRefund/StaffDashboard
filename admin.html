<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>My Refund – Admin Starting Volumes</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
@font-face { font-family:'Okta Neue'; src: local('Okta Neue'); }
:root{
  --green-dark:#094B35;
  --green:#03953F;
  --green-soft:#ECFDF5;
  --border:#e5e7eb;
  --text:#111827;
  --muted:#6b7280;
  --bg:#f6f7f8;
}
*{box-sizing:border-box}
body{margin:0;font-family:'Okta Neue',system-ui,sans-serif;background:var(--bg);color:var(--text)}
header{padding:16px 24px;background:#fff;border-bottom:1px solid var(--border)}
main{max-width:900px;margin:0 auto;padding:24px}
h1,h2{color:var(--green-dark);margin:0 0 10px}
.card{background:#fff;border-radius:16px;padding:16px;margin-bottom:16px}
.notice{background:var(--green-soft);padding:12px;border-radius:12px;font-weight:800;color:var(--green-dark)}
label{font-size:12px;color:var(--muted);font-weight:800}
input[type="date"],input[type="number"]{padding:8px;border-radius:8px;border:1px solid var(--border)}
.row{display:flex;gap:16px;flex-wrap:wrap}
.col{flex:1;min-width:200px}
button{padding:10px 14px;border-radius:10px;border:1px solid var(--green-dark);background:var(--green-dark);color:#fff;font-weight:900;cursor:pointer}
.muted{color:var(--muted);font-size:12px}
</style>
</head>
<body>

<header>
  <h1>Admin – Starting Volumes</h1>
</header>

<main>

<div class="card notice">
  Enter starting volumes for the selected date. These will feed directly into reports.
</div>

<div class="card">
  <label>Date</label><br>
  <input type="date" id="dateInput">
</div>

<div class="card">
  <h2>Starting volumes (start of day)</h2>
  <div class="row" id="startingFields"></div>
</div>

<div class="card">
  <h2>Missed interactions (end of day)</h2>
  <div class="row" id="missedFields"></div>
</div>

<div class="card">
  <button onclick="saveVolumes()">Save volumes</button>
  <p id="status" class="muted"></p>
</div>

</main>

<script>
const SUBMIT_ENDPOINT = "https://script.google.com/macros/s/AKfycbxrteoDa30Q_uz2-O4j_HE_agEpsCl7LlnPTghyWktDp2VXykkSHjoAqeZ4Jiz3nnYJ/exec";

const STARTING_WORK = ["Emails","Unverified","A2A","To Call"];
const MISSED_WORK = ["Missed Calls","Missed Chats"];

function nzToday(){
  return new Date().toLocaleDateString("en-CA",{ timeZone:"Pacific/Auckland" });
}

function render(){
  document.getElementById("dateInput").value = nzToday();

  const sWrap = document.getElementById("startingFields");
  const mWrap = document.getElementById("missedFields");

  STARTING_WORK.forEach(w=>{
    sWrap.innerHTML += fieldHTML(w);
  });
  MISSED_WORK.forEach(w=>{
    mWrap.innerHTML += fieldHTML(w);
  });
}

function fieldHTML(label){
  return `
    <div class="col">
      <label>${label}</label><br>
      <input type="number" min="0" value="0" id="field-${label.replace(/\s/g,'')}">
    </div>
  `;
}

function sendToSheets(payload){
  fetch(SUBMIT_ENDPOINT,{
    method:"POST",
    mode:"no-cors",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(payload)
  });
}

function saveVolumes(){
  const date = document.getElementById("dateInput").value;
  if(!date) return alert("Select a date");

  [...STARTING_WORK, ...MISSED_WORK].forEach(w=>{
    const id = "field-"+w.replace(/\s/g,'');
    const val = Number(document.getElementById(id).value||0);

    sendToSheets({
      starting:{
        date: date,
        work_type: w,
        volume: val
      }
    });
  });

  document.getElementById("status").textContent =
    "Saved at " + new Date().toLocaleTimeString();
}

render();
</script>

</body>
</html>
