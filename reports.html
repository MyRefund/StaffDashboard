<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="Content-Language" content="en">
<meta name="google" content="notranslate">
<title>My Refund — Reports</title>
<style>
/* ALL YOUR ORIGINAL CSS IS UNCHANGED */
:root{
  --g0:#094B35;
  --g2:#ECFDF5;
  --border:#e5e7eb;
  --text:#111827;
  --muted:#6b7280;
  --radius:16px;
  --shadow:0 12px 32px rgba(0,0,0,.12);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:"Okta Neue", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background:#f9fafb;
  color:var(--text);
}
/* (rest of your CSS remains exactly as provided — omitted here for brevity but unchanged) */
</style>
</head>
<body>

<!-- ALL YOUR EXISTING HTML REMAINS EXACTLY AS YOU PROVIDED ABOVE -->

<script>

/* ===========================
   BACKEND CONNECTION
=========================== */

const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwCZTuvnbwTAfkDXMjbLzCR-YXkzcbQ-hujbrZW7Hib5iLhbVwfkJ1xmSfpu-YfRGTn/exec";

/* ===========================
   NAV / CLOCK (UNCHANGED)
=========================== */

function goHome(){ window.location.href="index.html"; }

(function tick(){
  document.getElementById("clock").textContent =
    new Date().toLocaleTimeString("en-NZ",{hour:"numeric",minute:"2-digit",second:"2-digit"});
  setTimeout(tick,1000);
})();

/* ===========================
   DATE DEFAULTS (UNCHANGED)
=========================== */

const TZ = "Pacific/Auckland";
function nzISO(d=new Date()){
  return d.toLocaleDateString("en-CA",{timeZone:TZ});
}
const todayISO = nzISO();
document.getElementById("startDate").value = todayISO;
document.getElementById("endDate").value = todayISO;

/* ===========================
   RUN REPORT (NOW REAL DATA)
=========================== */

async function runReport(){

  document.getElementById("statusPill").textContent = "Loading…";

  const formData = new URLSearchParams();
  formData.append("action","getReportData");
  formData.append("start",document.getElementById("startDate").value);
  formData.append("end",document.getElementById("endDate").value);

  try{

    const res = await fetch(WEB_APP_URL,{
      method:"POST",
      body:formData
    });

    const data = await res.json();

    if(!data.ok){
      alert("Report error: "+data.error);
      return;
    }

    /* ===========================
       CSR SUMMARY
    ============================ */

    let csrTouchpoints = 0;

    data.csr.forEach(r=>{
      csrTouchpoints +=
        Number(r.Inbound||0) +
        Number(r.Outbound||0) +
        Number(r.Chat||0);
    });

    document.getElementById("touchpointsToday").textContent =
      csrTouchpoints.toLocaleString("en-NZ");

    /* ===========================
       PROCESSING SUMMARY
    ============================ */

    let totalOutput = 0;
    let totalFees = 0;

    data.processing.forEach(r=>{
      totalOutput += Number(r.TotalOutput||0);
      totalFees += Number(r.TotalFees||0);
    });

    document.getElementById("returnsToday").textContent =
      totalOutput.toLocaleString("en-NZ");

    document.getElementById("feesToday").textContent =
      "$"+totalFees.toLocaleString("en-NZ",{minimumFractionDigits:2});

    document.getElementById("statusPill").textContent = "Live Data";

  }catch(err){
    console.error(err);
    alert("Connection error.");
  }

}

</script>
</body>
</html>
