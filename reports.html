<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>My Refund – Staff Work Tracker</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
@font-face { font-family:'Okta Neue'; src: local('Okta Neue'); }
:root{
  --green-dark:#094B35;
  --green:#03953F;
  --green-soft:#ECFDF5;
  --border:#e5e7eb;
  --text:#111827;
  --muted:#6b7280;
  --bg:#f6f7f8;
}
*{box-sizing:border-box}
body{margin:0;font-family:'Okta Neue',system-ui,sans-serif;background:var(--bg);color:var(--text)}
header{display:flex;align-items:center;gap:16px;padding:16px 24px;background:#fff;border-bottom:1px solid var(--border)}
header img{max-width:140px}
main{max-width:1000px;margin:0 auto;padding:24px}
h1,h2,h3{color:var(--green-dark);margin:0 0 10px}
.card{background:#fff;border-radius:16px;padding:16px;margin-bottom:16px}
.notice{background:var(--green-soft);color:var(--green-dark);padding:12px;border-radius:14px;font-weight:900}
.muted{color:var(--muted);font-size:12px}
.row{display:flex;gap:12px;flex-wrap:wrap}
.col{flex:1;min-width:220px}
label{font-size:12px;color:var(--muted);font-weight:800}
button{padding:10px 14px;border-radius:10px;border:1px solid var(--border);background:#fff;font-weight:900;cursor:pointer}
button.primary{background:var(--green-dark);color:#fff;border-color:var(--green-dark)}
.counter{display:flex;align-items:center;gap:10px;margin-top:8px}
.counter span{font-weight:900;font-size:18px;min-width:32px;text-align:center}
.counter button{width:36px;height:36px;border-radius:50%}
input[type="number"]{width:80px;padding:6px;border-radius:8px;border:1px solid var(--border)}
.hidden{display:none}
</style>
</head>
<body>

<header>
  <img src="logo.png" alt="My Refund">
  <strong>Staff Work Tracker</strong>
</header>

<main>

<div id="loginView" class="card">
  <div class="notice">Welcome</div>
  <p class="muted">Select your name to start your day.</p>
  <select id="staffSelect"></select><br><br>
  <button class="primary" onclick="login()">Start work</button>
</div>

<div id="appView" class="hidden">
  <div class="card">
    <h2>Hello, <span id="staffName"></span></h2>
    <p class="muted">Your work today will be saved automatically.</p>
  </div>

  <div class="card">
    <h3>Allocated work</h3>
    <div id="workList"></div>
  </div>

  <div class="card">
    <button class="primary" onclick="submitWork()">Submit work</button>
    <p id="status" class="muted"></p>
  </div>
</div>

</main>

<script>
const SUBMIT_ENDPOINT = "https://script.google.com/macros/s/AKfycbxrteoDa30Q_uz2-O4j_HE_agEpsCl7LlnPTghyWktDp2VXykkSHjoAqeZ4Jiz3nnYJ/exec";

const STAFF = [
  { id:"s1", name:"Alice" },
  { id:"s2", name:"Bob" },
  { id:"s3", name:"Charlie" }
];

const WORK_TYPES = ["Emails","Inbound","Outbound","Live Chat"];

let currentStaff = null;
let counters = {};
let startTime = null;

(function init(){
  const sel = document.getElementById("staffSelect");
  STAFF.forEach(s=>{
    const o=document.createElement("option");
    o.value=s.id; o.textContent=s.name;
    sel.appendChild(o);
  });
})();

function login(){
  const id = document.getElementById("staffSelect").value;
  currentStaff = STAFF.find(s=>s.id===id);
  startTime = Date.now();
  document.getElementById("staffName").textContent = currentStaff.name;
  document.getElementById("loginView").classList.add("hidden");
  document.getElementById("appView").classList.remove("hidden");
  renderWork();
}

function renderWork(){
  const wrap = document.getElementById("workList");
  wrap.innerHTML="";
  WORK_TYPES.forEach(w=>{
    counters[w]=0;
    const div=document.createElement("div");
    div.className="counter";
    div.innerHTML = `
      <strong style="min-width:120px">${w}</strong>
      <button onclick="inc('${w}',-1)">−</button>
      <span id="count-${w}">0</span>
      <button onclick="inc('${w}',1)">+</button>
      <input type="number" min="0" value="0" onchange="setCount('${w}',this.value)">
    `;
    wrap.appendChild(div);
  });
}

function inc(w,delta){
  counters[w]=Math.max(0,(counters[w]||0)+delta);
  document.getElementById("count-"+w).textContent=counters[w];
}
function setCount(w,val){
  counters[w]=Math.max(0,Number(val)||0);
  document.getElementById("count-"+w).textContent=counters[w];
}

async function sendToSheets(payload){
  try{
    await fetch(SUBMIT_ENDPOINT,{
      method:"POST",
      mode:"no-cors",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify(payload)
    });
  }catch(e){
    alert("Could not save data. Please tell admin.");
  }
}

function submitWork(){
  const today = new Date().toISOString().slice(0,10);
  const minutesWorked = Math.round((Date.now()-startTime)/60000);

  Object.entries(counters).forEach(([work,qty])=>{
    if(qty>0){
      sendToSheets({
        activity:{
          date: today,
          staff_id: currentStaff.id,
          staff_name: currentStaff.name,
          work_type: work,
          quantity: qty
        }
      });
    }
  });

  sendToSheets({
    shift:{
      date: today,
      staff_id: currentStaff.id,
      staff_name: currentStaff.name,
      minutes_worked: minutesWorked
    }
  });

  document.getElementById("status").textContent =
    "Submitted at " + new Date().toLocaleTimeString();
}
</script>

</body>
</html>
